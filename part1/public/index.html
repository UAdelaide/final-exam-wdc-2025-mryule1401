<!DOCTYPE html>
<html lang="en">

<head>
    <title>dog of the day</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
    <div id="app">
        <h1>dog of the day</h1>
        <div v-if="dogImg">
            <img :src="dogImg" alt="dog">
        </div>
        <div class="dog-detail">
            <!-- Hardcoded details as fallback -->
            <p v-if="!dogInfo.length"><strong>Name:</strong> Fluffy</p>
            <p v-if="!dogInfo.length"><strong>Breed:</strong> Golden Retriever</p>
            <p v-if="!dogInfo.length"><strong>Size:</strong> Medium</p>
            <!-- Display single name and size from dogInfo -->
            <p v-if="dogInfo.length"><strong>Name: {{ currentDog.name }}</strong></p>
            <p v-if="dogInfo.length"><strong>Size: {{ currentDog.size }}</strong></p>
        </div>
        <button @click="nextDog">Next</button>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    dogImg: null,
                    dogInfo: [],
                    currentIndex: 0,
                    error: null // Added for error display
                };
            },
            computed: {
                currentDog() {
                    return this.dogInfo[this.currentIndex] || {};
                }
            },
            async mounted() {
                await this.fetchDogImg();

                try {
                    const dog = await fetch('/api/dogs');
                    if (!dog.ok) throw new Error('Failed to fetch dog info');
                    const data = await dog.json();
                    console.log('API dogs data:', data); // Debug log
                    this.dogInfo = Array.isArray(data) ? data : [data]; // Ensure array
                } catch (err) {
                    console.error('API error:', err.message);
                    this.error = err.message; // Display error if fetch fails
                }
            },
            methods: {
                async fetchDogImg() {
                    try {
                        const itemsRes = await fetch('https://dog.ceo/api/breeds/image/random');
                        if (!itemsRes.ok) throw new Error('Failed to fetch dog image');
                        const data = await itemsRes.json();
                        console.log('Dog API data:', data); // Debug log
                        this.dogImg = data.message;
                    } catch (err) {
                        console.error('Dog API error:', err.message);
                        this.error = err.message; // Display error if fetch fails
                    }
                },
                async nextDog() {
                    await this.fetchDogImg(); // Fetch new image
                    if (this.dogInfo.length > 0) {
                        this.currentIndex = (this.currentIndex + 1) % this.dogInfo.length; // Cycle to next dog
                    }
                }
            }
        }).mount('#app');
    </script>
</body>

</html>